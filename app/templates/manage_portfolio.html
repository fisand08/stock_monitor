{% extends "base.html" %}

{% block content %}
    <div class="middle-section section">
        <h2>Add Portfolio</h2>
        <form id="portfolio-form" method="POST">
            {{ form.hidden_tag() }}
            <div class="form-group">
                {{ form.portfolios.label(class="form-control-label") }}
                {{ form.portfolios(class="form-control", id="portfolio-dropdown") }}
            </div>
            <div class="form-group">
                {{ form.stock.label(class="form-control-label") }}
                {{ form.stock(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.amount.label(class="form-control-label") }}
                {{ form.amount(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.action.label(class="form-control-label") }}
                <div>
                    {% for subfield in form.action %}
                        <div class="form-check form-check-inline">
                            {{ subfield }}
                            {{ subfield.label(class="form-check-label") }}
                        </div>
                    {% endfor %}
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>

    <div class="right-section section">
        <h2>Current Stocks in Selected Portfolio</h2>
        <div id="current-stocks">
            <!-- Dynamic content will be inserted here -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Set default selection to the first portfolio
            var portfolioDropdown = document.getElementById('portfolio-dropdown');
            if (portfolioDropdown) {
                if (portfolioDropdown.selectedIndex === -1) {
                    portfolioDropdown.selectedIndex = 0;
                }
                
                // Event listener for dropdown change
                portfolioDropdown.addEventListener('change', function () {
                    var selectedPortfolioId = this.value;
                    if (selectedPortfolioId) {
                        // Make AJAX request to fetch updated data
                        var xhr = new XMLHttpRequest();
                        xhr.open('GET', '/get_portfolio_data/' + selectedPortfolioId, true);
                        xhr.onreadystatechange = function () {
                            if (xhr.readyState == 4 && xhr.status == 200) {
                                // Update content with received data
                                document.getElementById('current-stocks').innerHTML = xhr.responseText;
                            }
                        };
                        xhr.send();
                    }
                });
                
                // Trigger change event to load initial stocks
                portfolioDropdown.dispatchEvent(new Event('change'));
            }
        });
    </script>
{% endblock %}
